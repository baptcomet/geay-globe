<?php

/**
 * @var Blog\Entity\Article $article
 * @var Blog\Entity\Picture $picture
 * @var Blog\Entity\Tag $tag
 */

$title = $article->getTitle();
$subtitle = $article->getSubtitle();
$this->headTitle($title);

?>

<?php echo $this->partial('partial/flashmessenger') ?>

<script>
    function onImageLoad(pictureId) {
        var div = $('#picture-'+pictureId);
        var imgWidth = div.find('img').width();
        if (imgWidth) {
            div.css('width', (20+imgWidth)+'px');
        }
    }
</script>

<div class="row">
    <div class="box">
        <div class="row">
            <div class="col-lg-2">
            </div>
            <div class="col-lg-8 text-center">
                <hr class="short-hr"/>
                <h2><?php echo $title ?></h2>
                <h3 class="intro-subtext"><?php echo $subtitle ?></h3>
                <hr class="short-hr"/>
            </div>
            <div class="col-lg-2">
                <?php if (!is_null($this->identity())) : ?>
                    <ul class="list-inline pull-right">
                        <li>
                            <a href="<?php echo $this->url('article', array('action' => 'edit', 'id' => $article->getId())) ?>">
                                <span class="glyphicon glyphicon-pencil text-warning"></span>
                            </a>
                        </li>
                    </ul>
                    <br/>
                    <br/>
                <?php endif ?>
                <ul class="list-unstyled pull-right text-right">
                    <?php foreach ($article->getTags() as $tag) : ?>
                        <li>
                            <h4>
                                <a href="#" style="text-decoration: none">
                                    <span class="label label-info">#<?php echo $tag->getTitle() ?></span>
                                </a>
                            </h4>
                        </li>
                    <?php endforeach ?>
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <p class="text-<?php echo $article->getTextPosition() ?>">
                    <?php echo $article->getText() ?>
                </p>
            </div>
        </div>
        <br/>
        <?php foreach ($article->getPictures() as $picture) : ?>
            <?php $pictureSource = $this->url('picture', array('action' => 'images', 'id' => $article->getId(), 'name' => $picture->getFilename())) ?>
            <div class="row">
                <div class="col-lg-12">

                    <div id="picture-<?php echo $picture->getId() ?>"
                         class="image img-<?php echo $picture->getPosition() ?>" style="max-width: 100%">

                        <a class="fancybox" href="<?php echo $pictureSource ?>" rel="gallery"
                           title="<?php echo $picture->getLegend() ?>">
                            <img class="img-polaroid-border img-responsive"
                                 alt="<?php echo $picture->getLegend() ?>"
                                 style="max-width: 100%"
                                 onload="onImageLoad(<?php echo $picture->getId() ?>);"
                                 src="<?php echo $pictureSource ?>">
                            <div class="caption">
                                <span class="book"><?php echo $picture->getLegend() ?></span>
                            </div>
                        </a>

                    </div>

                    <?php if ($picture->getText()) : ?>
                        <p class="text-<?php echo $picture->getTextPosition() ?>">
                            <br/><?php echo $picture->getText() ?>
                        </p>
                    <?php endif ?>
                </div>
            </div>
            <br/>
        <?php endforeach ?>
    </div>
</div>

<script>
    $("a.fancybox").fancybox({
        'titlePositon' : 'over',
        'showNavArrows' : true,
        'overlayShow' : false
    });
</script>

<!--<script>-->
<!--    captionOn = function () {-->
<!--        var description = $('a[href="' + $('#imagelightbox').attr('src') + '"] img').attr('alt');-->
<!--        if (description.length > 0) {-->
<!--            $('<div id="imagelightbox-caption">' + description + '</div>').appendTo('body');-->
<!--        }-->
<!--    };-->
<!--    captionOff = function () {-->
<!--        $('#imagelightbox-caption').remove();-->
<!--    };-->
<!---->
<!--    $('a.imagelightbox').imageLightbox({-->
<!--        selector:       'id="imagelightbox"',   // string;-->
<!--        allowedTypes:   'png|jpg|jpeg|gif',     // string;-->
<!--        animationSpeed: 250,                    // integer;-->
<!--        preloadNext:    true,                   // bool;            silently preload the next image-->
<!--        enableKeyboard: true,                   // bool;            enable keyboard shortcuts (arrows Left/Right and Esc)-->
<!--        quitOnEnd:      false,                  // bool;            quit after viewing the last image-->
<!--        quitOnImgClick: false,                  // bool;            quit when the viewed image is clicked-->
<!--        quitOnDocClick: true,                   // bool;            quit when anything but the viewed image is clicked-->
<!--        onStart:        false,                  // function/bool;   calls function when the lightbox starts-->
<!--        onLoadStart: function () {-->
<!--            captionOff();-->
<!--        },-->
<!--        onLoadEnd: function () {-->
<!--            captionOn();-->
<!--        },-->
<!--        onEnd: function () {-->
<!--            captionOff();-->
<!--        }-->
<!--    });-->
<!--</script>-->